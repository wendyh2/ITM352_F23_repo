<!-- Author: Wendy Huang, Gellie Cabuyadao, Scott Garland-->
<!-- Assignment 1 -->
<!-- Date: 11/17/2023 -->
<!-- Cart Page -->

<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Receipt Sales</title>

    <script src="./getLoggedInUsers.js" type="text/javascript"></script>
    <script src="./products_data.js" type="text/javascript"></script>
    <script src="./get_cart.js" type="text/javascript"></script>
    <link href="invoice.css" rel="stylesheet">
    <link rel="stylesheet" href="products_style.css">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat" rel="stylesheet">
    <link
        href="https://fonts.googleapis.com/css2?family=Noto+Sans+Devanagari&family=Palanquin+Dark:wght@500&display=swap"
        rel="stylesheet">
    <link
        href="https://fonts.googleapis.com/css2?family=Dosis:wght@300&family=Noto+Sans+Devanagari&family=Palanquin+Dark:wght@500&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css"
        integrity="sha512-z3gLpd7yknf1YoNbCzqRKc4qyor8gaKU1qmn+CShxbuBusANI9QpRohGBreCFkKxLhei6S9CQXFEbbKuqLg0DA=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet" href="https://unpkg.com/boxicons@latest/css/boxicons.min.css">

    <script>
        const cart_data = cart;

        let params = (new URL(document.location)).searchParams;
        let prod_key = "Lorelei Collection"; //Default to Lorelei page if product_type isn't specified in the querystring
        if (params.has('product_type')) {
            prod_key = params.get('product_type');
        }
        let products = all_products[prod_key];

        /* Sales Receipt */
        // Subtotal
        var subtotal = 0;

    </script>
</head>

<body>
    <!--Displaying my header-->
    <header>
        <a href="index.html"><img src="img/logo.png" class="logo" alt="my logo"></a>
        <!--This is where my logo goes in my header-->
        <!--Got this from my home.html because it's my navigation menu-->
        <div class="navmenu">
            <a href="home.html">Home</a>
            <a href="products_display.html">Shop</a>
            <a href="about.html">About</a>
            <a href="contact.html">Contact</a>
            <div class="cart-icon">
                <a href="invoice.html"><i class="fa-solid fa-bag-shopping"></i></a>
            </div>
        </div>
    </header>

    <!-- Create div for spacing between header and rest of page -->
    <div class="header-spacing"></div>
    <section class="main-cart">
            <h1>Shopping Cart</h1>

    <!-- <form id="purchase-form" action="./login" method="POST">
        <input type="submit">Login to Complete Purchase</input>
    </form> -->


    <div class="flex-box-container">
        <div class="flex-box">
            <!--Where I will print my invoice-->
            <table border="2">
                <tbody>

                    <!-- column titles row -->
                    <tr>
                        <th style="text-align: center;" width="11%">Image</th>
                        <th style="text-align: center;" width="26%">Item</th>
                        <th style="text-align: center;" width="11%">Quantity</th>
                        <th style="text-align: center;" width="13%">Price</th>
                        <th style="text-align: center;" width="20%">Price Altogether</th>
                    </tr>
                    <script>
                        // generates rows with prices based on quantities
                        function generate_item_rows() {
                            for (let pkey in cart_data) {
                                let products = all_products[pkey];
                                for (let i in products) {
                                    let qty = cart_data[pkey]['quantity' + i];
                                    errors = findNonNegInt(qty, true);
                                    if (errors.length == 0) {
                                        var extended_price = qty * products[i].price;
                                        subtotal += extended_price;
                                    }
                                    else (extended_price = 0);

                                    // IR 5 - When diplaying the invoice, add a small icon image of the product to the line item, show description on mouseover
                                    document.write(`
            <tr>
             <td height="70px" width="11%">
              <div class="img-mouseover">
                <img src="./img/${products[i].image}" height="100px" width="100px">
                <div class="product-description">
                  ${products[i].description}
                  </div>
                </div></td>
              <td width="26%">${products[i].name}</td>
              <td align="center" width="11%">${qty}<br><font color = "red">${errors.join('<br>')}</td>
              <td width="13%">$${products[i].price}</td>
              <td width="20%">$${(extended_price).toFixed(2)}</td>
            </tr>
            `)
                                }
                            }
                        }

                        function findNonNegInt(q, returnErrors = false) { //the function returns non-negative integers in the object.
                            errors = []; // assume no errors at first
                            if (Number(q) != q) errors.push('Not a number!'); // Check if string is a number value
                            if (q < 0) errors.push('Negative value!'); // Check if it is non-negative
                            if (parseInt(q) != q) errors.push('Not an integer!'); // Check that it is an integer

                            return returnErrors ? errors : (errors.length == 0);
                        }

                        generate_item_rows();
                        // Tax rate
                        var tax_rate = 0.04712;
                        var tax = tax_rate * subtotal;

                        // Compute shipping (if subtotal is less than 80, shipping is $10, otherwise it's free)
                        if (subtotal < 80) { shipping = 10 }
                        else { shipping = 0 };

                        // Grand total
                        var total = subtotal + tax + shipping;

                        document.write(`
            <tr>
              <td colspan="5" width="100%">&nbsp;</td>
            </tr>
            <tr>
              <td style="text-align: right;" colspan="3" width="67%">Subtotal</td>
              <td colspan="2" width="54%">$${(subtotal).toFixed(2)}</td>
            </tr>
            <tr>
              <td style="text-align: right;" colspan="3" width="67%">Tax @ 4.71%</span></td>
              <td colspan="2" width="54%">$${(tax).toFixed(2)}</td>
            </tr>
            <tr>
              <td style="text-align: right;" colspan="3" width="67%">Shipping</span></td>
              <td colspan="2" width="54%">$${shipping}</td>
            </tr>
            <tr>
              <td style="text-align: right;" colspan="3" width="67%"><b>Total</b></td>
              <td colspan="2" width="54%"><b>$${(total).toFixed(2)}</b></td>
            </tr>
            `)
                    </script>
                </tbody>
            </table>
                <!-- Login to Check Out Button -->
<a href="login.html" class="main-btn">Login To Check Out</a>
            <h4><strong> Our shipping policy is: A subtotal of $0-$80 will be $10 shipping. Subtotals over $80 will have
                    free
                    shipping</strong></h4>
        </div>
    </div>
</body>

</html>